理解。改成「方向可調」的精簡PRD，保留選項與決策點，不含 migration、無程式碼。

# 目標

* Blog Index 支援可控排序。
* 未設定排序的文章自動排在最後。
* 後台可用「數字欄位」或「拖曳」調整。
* 可在不改資料結構的前提下調整策略。

# 成功指標

* 編輯者可在 60 秒內完成一次排序調整。
* 排序變更後，前台於 5 分鐘內一致。
* 無資料遺失與重複顯示。

# 排序策略（擇一或並存）

1. **Rank 欄位法（`sort_order`）**

   * 行為：以整數升冪顯示；空值排最後。
   * 優點：可精準插隊；API 穩定。
   * 風險：需定期重整間距避免擁擠。

2. **DnD 清單序法**

   * 行為：以後台清單順序為準，每次拖曳後批次覆寫 Rank。
   * 優點：直覺；多人協作可視化。
   * 風險：併發衝突，需鎖或最後寫入者勝。

3. **混合法（建議）**

   * 行為：平時用 DnD，單篇可手動填 Rank；空值自動附加。
   * 優點：彈性高；兼顧精準與易用。

# 顯示規則

* 排序優先序：`Rank（升冪） → 發布時間（降冪） → ID（升冪）`。
* 未設定 Rank 視為空值，排在已設定值之後。
* 分頁與快取：排序變更時使 `/blog` 與分頁快取失效。

# 後台操作面

* **單篇編輯**：數字欄位 +「附加到最後」按鈕。
* **清單排序**：可切換模式

  * 模式A：DnD，拖放即產生新序。
  * 模式B：批次輸入 Rank（表格或行內編輯）。
* **維護**：一鍵「重整排序間距」（非必須，僅在需要時用）。
* **權限**：僅內容管理角色可操作。
* **可及性**：鍵盤上下移動順序。

# 自動化規則

* 新建文章：若無 Rank，附加到現有最後。
* 複製文章：沿用或清空 Rank（以設定檔決定）。
* 刪除文章：不自動回填，保留其他項目順序。
* 重複 Rank：允許，前台以發布時間與ID裁決穩定順序；後台提示可整理。

# 設定檔（可開關）

* `sorting.mode`: `"rank" | "dnd" | "hybrid"`
* `sorting.spacing`: 整數，預設 100（用於維護時重整間距）
* `sorting.autoAppend`: `true/false`（未設 Rank 是否自動附加）
* `sorting.cacheBustPaths`: 路徑清單

# API 合約（抽象）

* 讀取：`GET /api/posts?order=index&limit=&cursor=`
* 單筆更新排序：`POST /api/posts/:id/sort-order { sort_order }`
* 批次更新排序：`POST /api/posts/sort-orders [{id, sort_order}]`
* 取得下一個附加位置：`GET /api/posts/next-sort-order`
  說明：僅定義行為，不限定底層實作。

# 風險與對策

* 併發拖曳：提示「有更新，請重載」，或在提交時做版本檢查。
* 排序耗盡：提供「重整間距」工具，再次分配整齊數列。
* 大清單性能：清單分頁與篩選；批次更新限制單次筆數。

# 發布步驟（高層）

1. 切換前台排序規則至上述優先序。
2. 上線後台排序介面（選定模式）。
3. 配置快取失效流程。
4. 驗收成功指標。

# 驗收測試（高層）

* 未填 Rank 的新文出現在最後。
* DnD 後前台順序正確。
* 輸入 Rank=150 的文章出現在 100 與 200 之間。
* 多人同時操作時，至少一方收到重載提示。
* 啟用「重整間距」後，順序不變、間距整齊。

# 尚待決策

* 主要模式選擇：`rank`、`dnd`、或 `hybrid`。
* 快取策略：即時失效或定時刷新。
* 併發策略：最後寫入者勝或版本鎖。
