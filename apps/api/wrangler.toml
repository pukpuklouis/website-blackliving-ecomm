# Single source of truth for database migrations and remote sync
# Production and staging share remote database, development uses local
# All migrations controlled from packages/db/

name = "blackliving-api"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[env.development]
name = "blackliving-api-dev"

[env.staging]
name = "blackliving-api-staging"

[env.production]
name = "blackliving-api"

# Production database (remote) - single source of truth
[[env.production.d1_databases]]
binding = "DB"
database_name = "blackliving-db"
database_id = "6e8078ae-a12b-48e2-ab44-f3adf4ba3482"
migrations_dir = "../../packages/db/migrations"

# Staging uses same remote database as production
[[env.staging.d1_databases]]
binding = "DB"
database_name = "blackliving-db"
database_id = "6e8078ae-a12b-48e2-ab44-f3adf4ba3482"
migrations_dir = "../../packages/db/migrations"

# Development uses local database only
[[env.development.d1_databases]]
binding = "DB"
database_name = "blackliving-db"
database_id = "local-dev-db-id"
migrations_dir = "../../packages/db/migrations"

# Default configurations (production)
[[d1_databases]]
binding = "DB"
database_name = "blackliving-db"
database_id = "6e8078ae-a12b-48e2-ab44-f3adf4ba3482"
migrations_dir = "../../packages/db/migrations"

[[env.production.r2_buckets]]
binding = "R2"
bucket_name = "blackliving-images"

# Cloudflare R2 Storage
[[r2_buckets]]
binding = "R2"
bucket_name = "blackliving-images"

[[env.development.r2_buckets]]
binding = "R2"
bucket_name = "blackliving-images-dev"

[[env.staging.r2_buckets]]
binding = "R2"
bucket_name = "blackliving-images"

# Cloudflare KV Storage
[[kv_namespaces]]
binding = "CACHE"
id = "e978fa20a08b46bea9bcb31400f8e61f"

[[env.development.kv_namespaces]]
binding = "CACHE"
id = "local-dev-kv-id"
preview_id = "local-dev-preview-kv-id"

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "e978fa20a08b46bea9bcb31400f8e61f"
preview_id = "e978fa20a08b46bea9bcb31400f8e61f"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "e978fa20a08b46bea9bcb31400f8e61f"
preview_id = "e978fa20a08b46bea9bcb31400f8e61f"

# Environment Variables (defaults to production)
[vars]
NODE_ENV = "production"
API_BASE_URL = "https://blackliving-api.pukpuk-tw.workers.dev"
WEB_BASE_URL = "https://blackliving-web.pages.dev"
ADMIN_BASE_URL = "https://blackliving-admin.pages.dev"

[env.development.vars]
NODE_ENV = "development"
API_BASE_URL = "http://localhost:8787"
WEB_BASE_URL = "http://localhost:4321"
ADMIN_BASE_URL = "http://localhost:5173"

[env.staging.vars]
NODE_ENV = "staging"
API_BASE_URL = "https://blackliving-api-staging.pukpuk-tw.workers.dev"
WEB_BASE_URL = "https://staging.blackliving-web.pages.dev"
ADMIN_BASE_URL = "https://staging.blackliving-admin.pages.dev"



# Secrets (set via wrangler secret put <SECRET_NAME> <VALUE> --env <ENVIRONMENT>)
# Required secrets for all environments:
# - BETTER_AUTH_SECRET
# - GOOGLE_CLIENT_ID
# - GOOGLE_CLIENT_SECRET  
# - GOOGLE_ADMIN_CLIENT_ID (for Option B)
# - GOOGLE_ADMIN_CLIENT_SECRET (for Option B)
# - GOOGLE_CUSTOMER_CLIENT_ID (for Option B)
# - GOOGLE_CUSTOMER_CLIENT_SECRET (for Option B)
# - JWT_SECRET (optional, for additional JWT operations)
