---
import BaseLayout from '../../layouts/BaseLayout.astro';
import CTA from '../../components/CTA.astro';
import BlogPostCard from '../../components/BlogPostCard.astro';
import type { BlogPostSummary, BlogPost, PostCategory } from '@blackliving/types';

const apiUrl = import.meta.env.PUBLIC_API_BASE_URL || 'http://localhost:8787';

// Single API call with enhanced endpoint - get customer reviews with embedded category data
const response = await fetch(`${apiUrl}/api/posts/public?category=customer-review&include=category`);
const data = await response.json();

// Transform to BlogPostSummary format for BlogPostCard compatibility
const posts: BlogPostSummary[] = (data.data || []).map((post: BlogPost & { category?: PostCategory }) => ({
  slug: post.slug,
  title: post.title,
  excerpt: post.excerpt,
  description: post.description,
  featuredImage: post.featuredImage,
  category: post.category?.name || post.category, // Use embedded category name or fallback
  readingTime: `${post.readingTime}`,
  authorName: post.authorName,
  publishedAt: post.publishedAt,
}));

---

<BaseLayout 
  title="顧客好評 - Black Living 黑哥家居"
  description="來自真實客戶的睡眠體驗分享，了解 Simmons 黑牌床墊的實際使用心得與評價"
>
  <main class='container mx-auto px-4 py-8 mb-12'>
    <div class='text-center mb-12'>
      <h1 class='text-4xl font-bold text-gray-900 mb-4'>顧客好評</h1>
      <p class='text-xl text-gray-600'>來自真實客戶的睡眠體驗分享</p>
    </div>


    <div class='max-w-4xl mx-auto'>
      <div class='grid grid-cols-1 md:grid-cols-2 gap-8'>
        {posts.map(post => (
          <BlogPostCard post={post} variant="vertical" />
        ))}
      </div>
      {
        posts.length === 0 && (
          <div class='text-center py-12'>
            <p class='text-gray-500'>目前尚無顧客評價...</p>
          </div>
        )
      }

    </div>
  </main>
  <CTA />
</BaseLayout>