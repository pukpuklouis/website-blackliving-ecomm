---
import CategoryPageLayout from '../../components/CategoryPageLayout.astro';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const categoriesEntries = await getCollection('categories');
  
  return categoriesEntries.map((entry) => ({
    params: { 
      category: entry.data.category 
    },
    props: { 
      categoryConfig: entry.data 
    }
  }));
}

const { category } = Astro.params;
const { categoryConfig } = Astro.props;

// Fallback check for dynamic routes
let finalConfig = categoryConfig;
if (!categoryConfig) {
  const categoryEntry = await getEntry('categories', category);
  if (!categoryEntry) {
    return Astro.redirect('/404');
  }
  finalConfig = categoryEntry.data;
}
---

<CategoryPageLayout categoryConfig={finalConfig} />