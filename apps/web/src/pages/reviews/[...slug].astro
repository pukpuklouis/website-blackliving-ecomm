---
import { getCollection } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';

// Generate all customer review pages
export async function getStaticPaths() {
  const customerReviews = await getCollection('customer-reviews');
  
  return customerReviews.map((review) => ({
    params: { slug: review.data.slug },
    props: { 
      post: {
        ...review.data,
        // Add review-specific metadata
        author: review.data.customerName || review.data.author,
      },
      // Get other customer reviews as related posts
      relatedPosts: customerReviews
        .filter(r => r.data.slug !== review.data.slug)
        .slice(0, 3)
        .map(r => r.data)
    },
  }));
}

const { post, relatedPosts } = Astro.props;

// SEO data for customer reviews
const seoTitle = post.seoTitle || `${post.title} | 顧客好評 | 黑哥家居`;
const seoDescription = post.seoDescription || post.excerpt || post.description;
const ogImage = post.featuredImage || '/images/default-og.jpg';
---

<PostLayout 
  {post}
  category={post.category}
  {relatedPosts}
  {seoTitle}
  {seoDescription}
  {ogImage}
/>