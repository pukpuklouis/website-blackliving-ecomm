---
import CategoryPageLayout from '../../layouts/CategoryPageLayout.astro';
import type { CategoryConfig } from '../../types/category.ts';
import { fetchCategoryConfig, generateCategoryStaticPaths } from '../../utils/productPaths.ts';

export const prerender = true;

interface StaticProps {
  categoryConfig?: CategoryConfig;
}

export async function getStaticPaths() {
  return await generateCategoryStaticPaths();
}

const { category } = Astro.params;
const { categoryConfig: prefetchedCategory } = (Astro.props as StaticProps) ?? {};

const { categoryConfig, error, notFound } = await fetchCategoryConfig(category, prefetchedCategory);

if (notFound || !categoryConfig) {
  return Astro.redirect('/404');
}

if (error) {
  console.warn(`Category fallback used for slug "${category}":`, error);
}
---

<CategoryPageLayout categoryConfig={categoryConfig} />
