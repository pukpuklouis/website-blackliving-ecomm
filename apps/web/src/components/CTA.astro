---
import { Image } from "astro:assets";
export type Props = {
  title?: string;
  description?: string;
  primaryButtonText?: string;
  primaryButtonHref?: string;
  secondaryButtonText?: string;
  secondaryButtonHref?: string;
  secondaryButtonTarget?: string;
  // Images
  desktopImage?: string;
  mobileImage?: string;
  // Text position (alignment of buttons)
  textAlignDesktop?: "left" | "center" | "right";
  textAlignMobile?: "left" | "center" | "right";
  // Gradient overlay
  gradientDirection?:
    | "left-to-right"
    | "right-to-left"
    | "top-to-bottom"
    | "bottom-to-top";
  gradientFromColor?: string;
  gradientToColor?: string;
  gradientOpacity?: number;
  className?: string;
};

const {
  title = "準備好體驗頂級睡眠了嗎？",
  description = "歡迎蒞臨我們的實體展間，親自體驗席夢思黑標床墊的舒適感受",
  desktopImage = "/CTA/blackliving-CTA-background-img.webp",
  mobileImage = "/CTA/blackliving-CTA-background-img.webp",
  textAlignDesktop = "left",
  textAlignMobile = "center",
  gradientDirection = "left-to-right",
  gradientFromColor = "transparent",
  gradientToColor = "black",
  gradientOpacity = 0.6,
  primaryButtonText = "立即預約試躺",
  primaryButtonHref = "/appointment",
  secondaryButtonText = "Line 線上諮詢",
  secondaryButtonHref = "https://line.me/R/ti/p/@blackking",
  secondaryButtonTarget = "_blank",
  className = "",
} = Astro.props;

// Convert gradient direction to Tailwind classes
const getTailwindGradient = (direction: string) => {
  switch (direction) {
    case "left-to-right":
      return "bg-gradient-to-r";
    case "right-to-left":
      return "bg-gradient-to-l";
    case "top-to-bottom":
      return "bg-gradient-to-b";
    case "bottom-to-top":
      return "bg-gradient-to-t";
    default:
      return "bg-gradient-to-r";
  }
};

// Convert color and opacity to Tailwind gradient colors
const getTailwindGradientColors = (
  fromColor: string,
  toColor: string,
  opacity: number
) => {
  // For custom colors or rgba values, use CSS custom properties
  if (
    fromColor.includes("rgba") ||
    toColor.includes("rgba") ||
    fromColor.includes("var(") ||
    toColor.includes("var(")
  ) {
    return ""; // Will fall back to inline styles
  }

  // Map common colors to Tailwind classes
  const colorMap: Record<string, string> = {
    transparent: "transparent",
    black: "black",
    white: "white",
    gray: "gray-900",
    red: "red-900",
    blue: "blue-900",
    green: "green-900",
  };

  const fromTailwind = colorMap[fromColor] || fromColor;
  const toTailwind = colorMap[toColor] || toColor;

  // Apply opacity if not using transparent
  const fromWithOpacity =
    fromColor === "transparent"
      ? "transparent"
      : `${fromTailwind}/${Math.round(opacity * 100)}`;
  const toWithOpacity =
    toColor === "transparent"
      ? "transparent"
      : `${toTailwind}/${Math.round(opacity * 100)}`;

  return `from-${fromWithOpacity} to-${toWithOpacity}`;
};
---

<section
  class={`relative w-screen aspect-square md:aspect-[32/9] flex items-center overflow-hidden ${className}`}
>
  <!-- Background Image -->
  <Image
    src={desktopImage}
    width={2048}
    height={569}
    alt="Call to Action Background"
    class="hidden md:block absolute inset-0 w-full h-full object-cover object-center"
    loading="lazy"
    decoding="async"
  />
  <Image
    src={mobileImage}
    width={1080}
    height={1080}
    alt="Call to Action Background"
    class="block md:hidden absolute inset-0 w-full aspect-square object-cover object-center"
    loading="lazy"
    decoding="async"
  />

  <!-- Gradient Overlay -->
  {getTailwindGradientColors(gradientFromColor, gradientToColor, gradientOpacity) ? (
      <div
        class={`absolute inset-0 ${getTailwindGradient(gradientDirection)} ${getTailwindGradientColors(gradientFromColor, gradientToColor, gradientOpacity)}`}
      />
    ) : (
      <div
        class="absolute inset-0"
        style={`background: linear-gradient(${gradientDirection === 'left-to-right' ? 'to right' : gradientDirection === 'right-to-left' ? 'to left' : gradientDirection === 'top-to-bottom' ? 'to bottom' : 'to top'}, ${gradientFromColor}, ${gradientToColor}); opacity: ${gradientOpacity};`}
      />
    )}

  <!-- Content -->
  <div
    class="relative z-10 w-full flex flex-col object-center md:object-left mx-auto px-4 md:px-16 py-16 text-gray-50"
  >
    <h2
      class="text-2xl text-center md:text-left md:text-3xl lg:text-4xl font-bold mb-2 text-shadow-lg"
    >
      {title}
    </h2>
    <p
      class="text-base md:text-lg lg:text-xl text-center md:text-left text-balance mb-8 text-gray-100 text-shadow-lg"
    >
      {description}
    </p>

    <div
      class={`flex flex-col w-full md:flex-row gap-2 md:gap-4 ${textAlignMobile === 'left' ? 'justify-start' : textAlignMobile === 'right' ? 'justify-end' : 'justify-center'} md:${textAlignDesktop === 'left' ? 'justify-start' : textAlignDesktop === 'right' ? 'justify-end' : 'justify-center'} items-center`}
    >
      <a
        href={primaryButtonHref}
        class="inline-block bg-gray-50 text-gray-900 px-4 md:px-8 py-2 font-semibold rounded-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105 shadow-lg"
      >
        {primaryButtonText}
      </a>
      <a
        href={secondaryButtonHref}
        target={secondaryButtonTarget}
        rel={secondaryButtonTarget === '_blank' ? 'noopener noreferrer' : undefined}
        class="inline-block backdrop-blur-sm border-2 border-gray-50 text-gray-50 text-shadow-lg px-4 md:px-8 py-2 font-semibold rounded-lg hover:bg-gray-50 hover:text-gray-900 hover:text-shadow-none transition-all duration-300 transform hover:scale-105 shadow-lg"
      >
        {secondaryButtonText}
      </a>
    </div>
  </div>
</section>
