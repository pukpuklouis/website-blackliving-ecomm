{
  "id": "snapshot_1762190618530_a9mip5j76",
  "approvalId": "approval_1762190618518_lejzznbp2",
  "approvalTitle": "Web Frontend Mattress & Accessory Products Tasks Document",
  "version": 1,
  "timestamp": "2025-11-03T17:23:38.527Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks – Web Frontend Mattress & Accessory Products (Minimal Change)\n\nThis plan aligns with the design, current Astro layout, existing components, and Zustand usage. It avoids introducing new route families, providers, or package UI components.\n\n## Phase 1: API (Hono) – Ensure payload parity\n\n- [ ] 1.1 Ensure featuresMarkdown is returned in product detail\n  - File: `apps/api/src/modules/products.ts`\n  - Details: Include `featuresMarkdown` (when non-empty) in the response for GET `/api/products/:slug` alongside existing fields (`images`, `variants`, `features[]`).\n  - Acceptance: Response shape matches design; frontend receives `featuresMarkdown` when present.\n\n## Phase 2: Shared Types\n\n- [ ] 2.1 Extend product types with optional markdown field\n  - File: `packages/types/index-fixed.ts`\n  - Details: Add `featuresMarkdown?: string` to `Product` while keeping `features?: string[]` for fallback.\n  - Acceptance: Types compile; API, web, and admin share consistent product type.\n\n## Phase 3: PDP wiring (Astro + React islands)\n\n- [ ] 3.1 Extend ProductTabs to support Markdown features\n  - File: `apps/web/src/components/ProductTabs.tsx`\n  - Details: Add optional prop `featuresMarkdown?: string`. If provided and non-empty, render via `BlogContent.astro` inside the existing card. Otherwise keep current icon+list from `features[]/categoryFeatures`.\n  - Acceptance: Visual layout unchanged; Markdown renders when available.\n\n- [ ] 3.2 Pass featuresMarkdown from PDP page to ProductTabs\n  - File: `apps/web/src/pages/shop/[category]/[productSlug].astro`\n  - Details: Pass `featuresMarkdown={product.featuresMarkdown}` to `ProductTabs` without removing `features` props.\n  - Acceptance: ProductTabs receives and renders Markdown when present.\n\n- [ ] 3.3 URL preselect for dropdowns (size, firmness)\n  - File: `apps/web/src/components/ProductVariantSelector.tsx`\n  - Details: On mount, parse `?size=` and `?firmness=` from location and preselect if values exist and are valid. On change, update the URL query using `history.replaceState` (no reload). Do not alter layout.\n  - Acceptance: Refresh preserves selection; selecting updates query; invalid params are ignored gracefully.\n\n## Phase 4: PLP (confirm essentials only)\n\n- [ ] 4.1 Verify lowest price display on cards\n  - File: `apps/web/src/pages/shop/[category]/index.astro` and relevant components\n  - Details: Confirm lowest variant price is displayed; no redesign.\n  - Acceptance: Lowest price visible; no layout regressions.\n\n## Phase 5: Testing\n\n- [ ] 5.1 Unit – Variant schema and URL preselect\n  - File: `apps/web/src/components/__tests__/ProductVariantSelector.test.tsx`\n  - Details: Test dynamic schema derivation, valid/invalid preselect params, and query updates on change.\n  - Acceptance: Tests pass; cover main decision paths.\n\n- [ ] 5.2 Unit – Markdown vs. list fallback\n  - File: `apps/web/src/components/__tests__/ProductTabs.markdown.test.tsx`\n  - Details: Render with `featuresMarkdown` → Markdown; without → icon list. Ensure no layout shift in wrapper elements.\n  - Acceptance: Tests pass; snapshot or role-based assertions validated.\n\n- [ ] 5.3 E2E – PDP selection and add-to-cart\n  - File: `apps/web/tests/e2e/pdp-variants.spec.ts`\n  - Details: Visit PDP with `?size=…&firmness=…`, verify preselect, change selection, add to cart, assert cart contents. Mobile viewport run included.\n  - Acceptance: E2E passes in CI.\n\nNotes\n- Do NOT introduce a new global `ProductProvider` or move state to a new context. Reuse local state and existing Zustand `useCartStore` only for cart actions.\n- Do NOT move components to `packages/ui/*`. Keep web components in `apps/web/src/components/*`.\n- Avoid layout changes; only augment behavior (Markdown features, URL preselect).\n",
  "fileStats": {
    "size": 3765,
    "lines": 64,
    "lastModified": "2025-11-03T17:20:36.195Z"
  },
  "comments": []
}