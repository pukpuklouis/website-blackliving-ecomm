{
  "id": "snapshot_1764506374772_npgt241df",
  "approvalId": "approval_1764506374747_nurxptzfv",
  "approvalTitle": "Logistic Settings Tasks",
  "version": 1,
  "timestamp": "2025-11-30T12:39:34.772Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks: Flexible Logistic Settings\n\n- [ ] 1. Database Implementation\n    - [ ] 1.1 Create `settings` table in `packages/db/schema.ts`\n        - File: `packages/db/schema.ts`\n        - Define `settings` table with `id`, `key`, `value` (JSON), `updatedAt`\n        - Purpose: Store global application settings\n        - _Leverage: Existing schema definitions in `packages/db/schema.ts`_\n        - _Requirements: 1.1_\n    - [ ] 1.2 Run migration/push to update DB\n        - Command: `pnpm db:push` (or equivalent for the project)\n        - Purpose: Apply schema changes to the database\n        - _Requirements: 1.1_\n\n- [ ] 2. API Implementation\n    - [ ] 2.1 Create `modules/settings.ts` in `apps/api`\n        - File: `apps/api/src/modules/settings.ts`\n        - Initialize Hono app for settings\n        - Define Zod schemas for validation\n        - _Leverage: `apps/api/src/modules/products.ts` pattern_\n        - _Requirements: 1.1_\n    - [ ] 2.2 Implement `GET /api/settings/:key`\n        - File: `apps/api/src/modules/settings.ts`\n        - Fetch setting by key from DB\n        - Return 404 if not found (or default value if appropriate)\n        - _Requirements: 1.1_\n    - [ ] 2.3 Implement `PUT /api/settings/:key`\n        - File: `apps/api/src/modules/settings.ts`\n        - Protect with `requireAdmin`\n        - Validate input body\n        - Upsert setting to DB\n        - _Requirements: 1.1_\n    - [ ] 2.4 Register new module in `apps/api/src/index.ts`\n        - File: `apps/api/src/index.ts`\n        - Mount `settings` module at `/api/settings`\n        - _Requirements: 1.1_\n\n- [ ] 3. Admin Panel Implementation\n    - [ ] 3.1 Create `SettingsPage.tsx`\n        - File: `apps/admin/app/routes/dashboard/settings.tsx`\n        - Create UI for Logistic Settings (Shipping Fee, Threshold)\n        - Fetch current settings on load\n        - _Leverage: `apps/admin/app/components/ProductForm.tsx` patterns_\n        - _Requirements: 1.1_\n    - [ ] 3.2 Implement Update Logic\n        - File: `apps/admin/app/routes/dashboard/settings.tsx`\n        - Handle form submission\n        - Call `PUT /api/settings/logistic_settings`\n        - Show success/error toast\n        - _Requirements: 1.1_\n    - [ ] 3.3 Add \"Settings\" link to sidebar\n        - File: `apps/admin/app/components/Sidebar.tsx` (or equivalent)\n        - Add navigation item for `/dashboard/settings`\n        - _Requirements: 1.1_\n\n- [ ] 4. Web App Implementation\n    - [ ] 4.1 Update `cartStore.ts` to fetch settings\n        - File: `apps/web/src/stores/cartStore.ts`\n        - Add `fetchSettings` action\n        - Add `logisticSettings` state\n        - Call `fetchSettings` on store initialization (or app mount)\n        - _Requirements: 2.1_\n    - [ ] 4.2 Update `calculateShippingFee`\n        - File: `apps/web/src/stores/cartStore.ts`\n        - Use `logisticSettings` values if available\n        - Fallback to constants (1500, 30000)\n        - _Requirements: 2.1_\n    - [ ] 4.3 Verify `CheckoutForm`\n        - File: `apps/web/src/components/CheckoutForm.tsx`\n        - Ensure it reacts to changes in `shippingFee` from the store\n        - _Requirements: 2.1_\n\n- [ ] 5. Verification\n    - [ ] 5.1 Test Admin Flow\n        - Change settings in Admin\n        - Verify persistence in DB\n    - [ ] 5.2 Test Web Flow\n        - Verify frontend reflects new settings\n        - Verify cart calculation updates correctly\n",
  "fileStats": {
    "size": 3374,
    "lines": 80,
    "lastModified": "2025-11-30T12:39:32.664Z"
  },
  "comments": []
}
