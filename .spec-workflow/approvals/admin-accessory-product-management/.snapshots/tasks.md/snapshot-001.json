{
  "id": "snapshot_1762181067730_hm6mhvabc",
  "approvalId": "approval_1762181067716_vth07o0s5",
  "approvalTitle": "Admin Accessory Product Management Tasks",
  "version": 1,
  "timestamp": "2025-11-03T14:44:27.730Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Admin Accessory Product Management Tasks\n\n- [ ] 1. Extend Zod validation schemas for accessory product fields\n  - File: packages/db/schema.ts (modify existing), apps/api/src/modules/products.ts (modify existing)\n  - Extend existing product validation schemas to include accessoryType, parentProductId, featuresMarkdown, and enhanced variant fields\n  - Add validation for SKU length (≤32 characters), optionValues constraints, and accessory-specific fields\n  - Purpose: Establish type safety and validation for accessory product data structures\n  - _Leverage: existing product schema in packages/db/schema.ts, existing Zod validation in apps/api/src/modules/products.ts_\n  - _Requirements: 1, 6, 7_\n  - _Prompt: Role: Backend Developer specializing in TypeScript and data validation | Task: Extend existing Zod schemas in products module to support accessory product fields (accessoryType, parentProductId, featuresMarkdown) and enhanced variant validation including SKU length limits and optionValues constraints as specified in requirements 1, 6, and 7 | Restrictions: Do not break existing product validation, maintain backward compatibility, follow existing schema patterns | Success: All accessory fields are properly validated, existing product creation still works, new validation rules prevent invalid accessory data_\n\n- [ ] 2. Create product type templates configuration\n  - File: packages/types/src/product-templates.ts (new), apps/admin/src/lib/product-templates.ts (new)\n  - Define TypeScript interfaces for ProductTypeTemplate, VariantAxis, and ProductOptions\n  - Implement template configurations for mattress, protector, sheet-set, pillow, duvet, topper, adjustable-base, and other types\n  - Create utility functions for template selection and validation\n  - Purpose: Provide predefined templates for different accessory categories with appropriate variant axes\n  - _Leverage: existing type definitions in packages/types/src/products.ts, existing utility patterns in apps/admin/src/lib/_\n  - _Requirements: 1_\n  - _Prompt: Role: TypeScript Developer specializing in configuration and type systems | Task: Create comprehensive product type template system with TypeScript interfaces and configurations for all accessory types as specified in requirement 1, including mattress, protector, sheet-set, pillow, duvet, topper, adjustable-base templates with their respective variant axes and default options | Restrictions: Must support optional thickness axis for toppers, maintain type safety, follow existing naming conventions | Success: All product types have complete template definitions, templates are easily selectable and validated, TypeScript compilation passes without errors_\n\n- [ ] 3. Implement SKU generation utilities\n  - File: apps/admin/src/lib/sku-generator.ts (new), apps/admin/src/lib/__tests__/sku-generator.test.ts (new)\n  - Create SKU generation function following format: {CATEGORY}-{SERIES}-{SIZE}-{ATTR...}\n  - Implement abbreviation mapping for SIZE/COLOR/WEIGHT/THICKNESS/LOFT\n  - Add uniqueness validation and length checking (≤32 characters)\n  - Create SKU suggestion functionality for conflicts\n  - Purpose: Provide consistent SKU generation and validation for accessory products\n  - _Leverage: existing utility patterns in apps/admin/src/lib/_, existing validation patterns_\n  - _Requirements: 6_\n  - _Prompt: Role: Frontend Developer specializing in business logic and utility functions | Task: Implement comprehensive SKU generation system following requirement 6 format with abbreviation mappings, uniqueness validation, and conflict resolution suggestions, ensuring SKUs are ≤32 characters and follow the established pattern | Restrictions: Must handle all accessory-specific attributes, provide meaningful suggestions for conflicts, maintain performance for bulk operations | Success: SKU generation works for all product types, uniqueness is validated, suggestions are helpful for resolving conflicts, all edge cases handled_\n\n- [ ] 4. Extend products API module with accessory endpoints\n  - File: apps/api/src/modules/products.ts (modify existing)\n  - Add POST /admin/products/{id}/variants:generate endpoint with exclude parameter\n  - Add PUT /admin/variants/batch endpoint with mode parameter (overwrite/fill-empty/increment)\n  - Add POST /admin/products/{id}:archive endpoint for product archival\n  - Add CSV import/export endpoints with filtering support\n  - Purpose: Provide comprehensive API support for accessory product management operations\n  - _Leverage: existing products module structure, existing Hono patterns, existing validation utilities_\n  - _Requirements: 10_\n  - _Prompt: Role: Backend Developer specializing in REST API design and Hono framework | Task: Extend existing products API module with new accessory-specific endpoints following requirement 10, including variant generation with exclusions, batch operations with modes, archival functionality, and CSV operations with filtering | Restrictions: Must maintain existing API compatibility, follow REST conventions, implement proper error handling and validation | Success: All new endpoints work correctly, existing endpoints remain functional, proper error responses and validation implemented_\n\n- [ ] 5. Create dedicated ProductEditPage component\n  - File: apps/admin/app/routes/dashboard/products.$productId.edit.tsx (new), apps/admin/app/components/ProductEditPage.tsx (new)\n  - Implement dedicated page route at /dashboard/products/{id}/edit and /dashboard/products/new\n  - Create organized sections: Basic Info, Media, Specifications, Features, Advanced Settings\n  - Integrate BlockNote editor for featuresMarkdown with fallback handling\n  - Add auto-save to localStorage and unsaved changes confirmation\n  - Purpose: Replace modal-based editing with dedicated page for complex product configurations\n  - _Leverage: existing React Router patterns, existing form components, BlockNote editor integration_\n  - _Requirements: 3_\n  - _Prompt: Role: React Developer specializing in complex forms and page-level components | Task: Create dedicated ProductEditPage component with organized sections and BlockNote integration following requirement 3, implementing auto-save, change detection, and proper navigation handling | Restrictions: Must maintain existing product creation flow, ensure mobile responsiveness, handle large forms efficiently | Success: Page loads quickly, form sections are well-organized, BlockNote editor works seamlessly, auto-save prevents data loss_\n\n- [ ] 6. Implement VariantMatrixGenerator component\n  - File: apps/admin/app/components/VariantMatrixGenerator.tsx (new), apps/admin/app/components/__tests__/VariantMatrixGenerator.test.tsx (new)\n  - Create component for automatic variant generation from option combinations\n  - Implement exclude functionality for unwanted combinations\n  - Add table/card view switching for large matrices\n  - Integrate with SKU generation for automatic SKU assignment\n  - Purpose: Enable efficient creation of product variants from selected options\n  - _Leverage: existing table components, existing form patterns, SKU generation utilities_\n  - _Requirements: 4_\n  - _Prompt: Role: React Developer specializing in data manipulation and complex UI interactions | Task: Implement VariantMatrixGenerator component following requirement 4 with automatic variant generation, exclusion support, view switching, and SKU integration for efficient accessory product variant management | Restrictions: Must handle large matrices efficiently, provide clear feedback for complex combinations, maintain performance with 100+ variants | Success: Variant generation works for all product types, exclusion functionality prevents unwanted combinations, UI remains responsive with large datasets_\n\n- [ ] 7. Build BatchOperationsToolbar component\n  - File: apps/admin/app/components/BatchOperationsToolbar.tsx (new), apps/admin/app/components/__tests__/BatchOperationsToolbar.test.tsx (new)\n  - Implement batch operations with three modes: overwrite, fill-empty, increment\n  - Support pricing updates with differential calculations\n  - Add inventory management with stock level operations\n  - Include image batch assignment by color/style options\n  - Purpose: Provide bulk editing capabilities for efficient accessory product management\n  - _Leverage: existing modal patterns, existing form validation, existing batch operation patterns_\n  - _Requirements: 5_\n  - _Prompt: Role: React Developer specializing in bulk operations and data manipulation | Task: Build BatchOperationsToolbar component implementing three operation modes (overwrite/fill-empty/increment) following requirement 5, supporting pricing differentials, inventory management, and image batch assignment | Restrictions: Must provide clear preview of changes, prevent accidental data loss, handle large selections efficiently | Success: All batch operations work correctly, changes are previewed clearly, operations complete efficiently even with large selections_\n\n- [ ] 8. Refactor ProductManagement.tsx to reduce complexity\n  - File: apps/admin/app/components/ProductManagement.tsx (modify existing)\n  - Extract shared logic into separate utility functions\n  - Split large component into smaller focused components\n  - Reduce file size to under 500 lines as specified\n  - Maintain existing functionality while improving maintainability\n  - Purpose: Improve code maintainability and reduce technical debt in product management\n  - _Leverage: existing component patterns, existing utility functions, extracted components from previous tasks_\n  - _Requirements: 3_\n  - _Prompt: Role: Senior React Developer specializing in code refactoring and maintainability | Task: Refactor ProductManagement.tsx following requirement 3 to reduce complexity below 500 lines by extracting utilities and components while maintaining all existing functionality and improving code organization | Restrictions: Must not break existing functionality, maintain backward compatibility, improve rather than degrade user experience | Success: File size reduced below 500 lines, functionality preserved, code is more maintainable and better organized_\n\n- [ ] 9. Integrate approval workflow UI components\n  - File: apps/admin/app/components/ProductApprovalWorkflow.tsx (new), apps/admin/app/hooks/useProductApproval.ts (new)\n  - Implement status transitions: draft → in_review → published → archived\n  - Add role-based permissions for editors vs admins\n  - Create audit logging for status changes with field-level diffs\n  - Integrate with existing product management UI\n  - Purpose: Enable structured approval process for accessory product publishing\n  - _Leverage: existing permission system, existing status management, existing audit patterns_\n  - _Requirements: 7, 9_\n  - _Prompt: Role: Full-stack Developer specializing in workflow and permission systems | Task: Integrate approval workflow UI following requirements 7 and 9 with status transitions, role-based permissions, and audit logging for field-level changes in accessory product management | Restrictions: Must respect existing permission system, provide clear status feedback, maintain data integrity during transitions | Success: Approval workflow works seamlessly, permissions are properly enforced, audit trail captures all changes accurately_\n\n- [ ] 10. Implement CSV import/export functionality\n  - File: apps/admin/app/components/ProductCsvImport.tsx (new), apps/admin/app/components/ProductCsvExport.tsx (new), apps/admin/app/lib/csv-processor.ts (new)\n  - Add export filtering by status, series, and type with timestamped filenames\n  - Implement CSV parsing with validation and error reporting\n  - Support \"skip errors\" mode for partial imports\n  - Create downloadable error reports with row numbers\n  - Purpose: Enable bulk product management through CSV operations\n  - _Leverage: existing file upload patterns, existing validation utilities, existing export patterns_\n  - _Requirements: 8_\n  - _Prompt: Role: Full-stack Developer specializing in data import/export and file processing | Task: Implement comprehensive CSV import/export functionality following requirement 8 with filtering, validation, error reporting, and partial import support for efficient accessory product bulk management | Restrictions: Must handle large files efficiently, provide clear error feedback, maintain data consistency during imports | Success: CSV operations work reliably, error reporting is helpful, large datasets are processed efficiently_\n\n- [ ] 11. Add comprehensive testing coverage\n  - File: apps/admin/app/components/__tests__/ProductEditPage.test.tsx (new), apps/admin/app/components/__tests__/VariantMatrixGenerator.test.tsx (new), apps/admin/app/components/__tests__/BatchOperationsToolbar.test.tsx (new), apps/api/src/modules/__tests__/products-accessory.test.ts (new)\n  - Write unit tests for all new components and utilities\n  - Create integration tests for API endpoints\n  - Add end-to-end tests for critical user workflows\n  - Ensure test coverage meets project standards\n  - Purpose: Validate accessory product management functionality and prevent regressions\n  - _Leverage: existing test patterns, existing test utilities, existing testing framework (Vitest)_\n  - _Requirements: All_\n  - _Prompt: Role: QA Engineer specializing in React component testing and API integration testing | Task: Create comprehensive test coverage for all accessory product management features including unit tests for components, integration tests for APIs, and E2E tests for critical workflows to ensure reliability and prevent regressions | Restrictions: Must achieve adequate test coverage, tests must run in CI/CD pipeline, focus on business logic rather than implementation details | Success: All critical paths tested, tests run reliably, coverage meets project standards, regressions are caught early_\n\n- [ ] 12. Performance optimization and accessibility improvements\n  - File: apps/admin/app/components/VariantMatrixGenerator.tsx (modify), apps/admin/app/components/ProductEditPage.tsx (modify), apps/admin/app/lib/sku-generator.ts (modify)\n  - Optimize variant matrix rendering for large datasets (100+ variants)\n  - Implement virtual scrolling for performance\n  - Add keyboard navigation and screen reader support\n  - Optimize SKU generation for bulk operations\n  - Purpose: Ensure accessory product management scales and is accessible to all users\n  - _Leverage: existing performance patterns, existing accessibility utilities, React performance best practices_\n  - _Requirements: All_\n  - _Prompt: Role: Senior Frontend Developer specializing in performance optimization and accessibility | Task: Optimize accessory product management components for large datasets and improve accessibility following all requirements, implementing virtual scrolling, keyboard navigation, and performance optimizations | Restrictions: Must maintain existing functionality, improve rather than degrade performance, meet WCAG accessibility standards | Success: Large variant matrices render efficiently, keyboard navigation works throughout, screen readers are properly supported, performance benchmarks are met_\n\n- [ ] 13. Documentation and final integration\n  - File: docs/admin-accessory-products.md (new), apps/admin/README-accessory-products.md (new)\n  - Create comprehensive documentation for accessory product features\n  - Update existing admin documentation with new capabilities\n  - Perform final integration testing across all components\n  - Ensure all acceptance criteria from requirements are met\n  - Purpose: Complete the accessory product management implementation with proper documentation\n  - _Leverage: existing documentation patterns, existing README structures, testing utilities_\n  - _Requirements: All_\n  - _Prompt: Role: Technical Writer and Integration Engineer | Task: Complete accessory product management implementation with comprehensive documentation and final integration testing, ensuring all requirements are met and the feature is ready for production use | Restrictions: Must document all features thoroughly, ensure integration works across all components, validate against all acceptance criteria | Success: Documentation is complete and accurate, all components integrate seamlessly, acceptance criteria are validated, feature is production-ready_\n",
  "fileStats": {
    "size": 16355,
    "lines": 142,
    "lastModified": "2025-11-03T14:44:21.700Z"
  },
  "comments": []
}
