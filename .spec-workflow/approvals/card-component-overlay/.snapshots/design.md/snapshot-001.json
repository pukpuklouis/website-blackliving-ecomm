{
  "id": "snapshot_1761891784300_qbnn4nn6u",
  "approvalId": "approval_1761891784280_w3dccmmzr",
  "approvalTitle": "Card Component Overlay Design",
  "version": 1,
  "timestamp": "2025-10-31T06:23:04.300Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThe Card Component Overlay feature enhances the existing BlogPostCard component with configurable text and gradient overlays. This feature allows content creators to add compelling overlay text directly on blog post card images through an admin interface, improving visual hierarchy and user engagement while maintaining the existing card layout and functionality.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n- **TypeScript 5.x**: All new code will use strict TypeScript with proper type definitions\n- **React 19.x**: Component development follows React best practices with hooks\n- **Tailwind CSS**: Utility-first styling with consistent design tokens\n- **Drizzle ORM**: Database operations use type-safe queries\n- **Cloudflare D1**: SQLite-compatible database for data persistence\n- **Astro.js**: Server-side rendering for optimal performance\n\n### Project Structure (structure.md)\n- **Modular Components**: Overlay logic separated from core card functionality\n- **Feature-based Organization**: Related components and utilities grouped together\n- **Type Safety**: Comprehensive TypeScript interfaces for all data structures\n- **Consistent Naming**: kebab-case for files, PascalCase for components\n- **Import Patterns**: Barrel exports for clean public APIs\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **BlogPostCard** (`apps/web/src/components/BlogPostCard.tsx`): Core card component to extend with overlay functionality\n- **BlogComposer** (`apps/admin/app/components/BlogComposer.tsx`): Admin form component to extend with overlay settings\n- **UI Components** (`packages/ui/`): Button, Input, Select, Switch, Card components for admin interface\n\n### Integration Points\n\n- **Database Schema** (`packages/db/schema.ts`): Extend posts table with overlay fields\n- **API Routes** (`apps/api/src/routes/`): Update posts CRUD operations to handle overlay data\n- **Type Definitions** (`packages/types/`): Extend blog post types with overlay properties\n- **Admin Dashboard** (`apps/admin/`): Integrate overlay settings into blog composer workflow\n\n## Architecture\n\n### Component Architecture\n\n```mermaid\ngraph TD\n    A[BlogPostCard] --> B[OverlayContainer]\n    B --> C[GradientOverlay]\n    B --> D[TextOverlay]\n    D --> E[OverlayTitle]\n    D --> F[OverlaySubtitle]\n    D --> G[OverlayCTA]\n\n    H[BlogComposer] --> I[OverlaySettings]\n    I --> J[OverlayToggle]\n    I --> K[TextInputs]\n    I --> L[PlacementSelect]\n    I --> M[GradientControls]\n```\n\n### Data Flow Architecture\n\n```mermaid\ngraph TD\n    A[Admin Interface] --> B[BlogComposer Form]\n    B --> C[Zod Validation]\n    C --> D[API Request]\n    D --> E[Cloudflare Worker]\n    E --> F[Drizzle ORM]\n    F --> G[Cloudflare D1]\n    G --> H[Response]\n    H --> I[Admin UI Update]\n\n    J[Frontend] --> K[BlogPostCard]\n    K --> L[Conditional Rendering]\n    L --> M[Overlay Components]\n    M --> N[Tailwind Classes]\n```\n\n## Components and Interfaces\n\n### BlogPostCard Component (Enhanced)\n\n**Purpose:** Display blog post cards with optional overlay text and gradients\n**Location:** `apps/web/src/components/BlogPostCard.tsx`\n\n**New Props:**\n```typescript\ninterface BlogPostCardProps {\n  post: BlogPost & {\n    overlayEnabled?: boolean;\n    overlayTitle?: string;\n    overlaySubtitle?: string;\n    overlayPlacement?: 'bottom-left' | 'bottom-right' | 'top-left' | 'center';\n    overlayCtaText?: string;\n    overlayGradientEnabled?: boolean;\n    overlayGradientDirection?: string;\n  };\n  variant?: 'vertical' | 'horizontal';\n  className?: string;\n  href: string;\n}\n```\n\n**Key Methods:**\n- `renderOverlay()`: Conditionally render overlay components\n- `getOverlayClasses()`: Generate Tailwind classes based on placement\n- `getGradientClasses()`: Generate gradient background classes\n\n### OverlayContainer Component (New)\n\n**Purpose:** Container component for overlay elements with positioning logic\n**Location:** `apps/web/src/components/OverlayContainer.tsx`\n\n**Props:**\n```typescript\ninterface OverlayContainerProps {\n  placement: 'bottom-left' | 'bottom-right' | 'top-left' | 'center';\n  children: React.ReactNode;\n  className?: string;\n}\n```\n\n### BlogComposer Overlay Section (New)\n\n**Purpose:** Admin interface for configuring overlay settings\n**Location:** `apps/admin/app/components/BlogComposer.tsx` (extended)\n\n**Form Fields:**\n- `overlayEnabled`: Boolean switch\n- `overlayTitle`: Text input (max 50 chars)\n- `overlaySubtitle`: Textarea (max 100 chars)\n- `overlayPlacement`: Select dropdown\n- `overlayCtaText`: Text input (max 20 chars)\n- `overlayGradientEnabled`: Boolean switch\n- `overlayGradientDirection`: Select dropdown\n\n## Data Models\n\n### Extended BlogPost Model\n\n```typescript\ninterface BlogPost {\n  // Existing fields...\n  id: string;\n  title: string;\n  slug: string;\n  description: string;\n  content: string;\n  excerpt?: string;\n  authorId?: string;\n  authorName?: string;\n  status: 'draft' | 'published' | 'scheduled' | 'archived';\n  featured: boolean;\n  categoryId?: string;\n  category: string;\n  tags: string[];\n  featuredImage?: string;\n  // SEO fields...\n  // Publishing fields...\n  // Analytics fields...\n  // Settings...\n\n  // New overlay fields\n  overlayEnabled: boolean;\n  overlayTitle?: string;\n  overlaySubtitle?: string;\n  overlayPlacement: 'bottom-left' | 'bottom-right' | 'top-left' | 'center';\n  overlayCtaText?: string;\n  overlayGradientEnabled: boolean;\n  overlayGradientDirection: string;\n\n  createdAt: Date;\n  updatedAt: Date;\n}\n```\n\n### Database Schema Extension\n\n**Posts Table Additions:**\n```sql\n-- Overlay Text Settings\noverlay_enabled BOOLEAN DEFAULT FALSE,\noverlay_title TEXT,                    -- 疊加標題 (max 50 chars)\noverlay_subtitle TEXT,                 -- 疊加副標 (max 100 chars)\noverlay_placement TEXT DEFAULT 'bottom-left', -- 位置設定\noverlay_cta_text TEXT,                 -- CTA 文字 (max 20 chars)\n\n-- Overlay Gradient Settings\noverlay_gradient_enabled BOOLEAN DEFAULT TRUE,\noverlay_gradient_direction TEXT DEFAULT 'b', -- 漸層方向\n```\n\n## Error Handling\n\n### Validation Errors\n1. **Text Length Exceeded:** When overlay text exceeds character limits\n   - **Handling:** Form validation with Zod schema\n   - **User Impact:** Inline error messages with character counts\n\n2. **Invalid Placement Value:** When placement value is not in allowed set\n   - **Handling:** Select dropdown with predefined options\n   - **User Impact:** No invalid values possible through UI\n\n### Runtime Errors\n1. **Missing Overlay Data:** When post data doesn't include overlay fields\n   - **Handling:** Default values and optional chaining\n   - **User Impact:** Graceful fallback to no overlay\n\n2. **CSS Class Generation Failure:** When Tailwind classes can't be generated\n   - **Handling:** Fallback to safe default classes\n   - **User Impact:** Overlay still renders with basic styling\n\n## Testing Strategy\n\n### Unit Testing\n- **BlogPostCard Component:** Test overlay rendering with different placements\n- **OverlayContainer Component:** Test positioning logic and class generation\n- **Form Validation:** Test Zod schema validation for overlay fields\n- **Utility Functions:** Test gradient and text positioning helpers\n\n### Integration Testing\n- **Admin Form Submission:** Test complete overlay settings save flow\n- **API Integration:** Test overlay data persistence and retrieval\n- **Component Integration:** Test BlogPostCard with overlay props\n\n### End-to-End Testing\n- **Admin Workflow:** Create/edit post with overlay settings\n- **Frontend Display:** Verify overlay renders correctly on blog listing pages\n- **Responsive Behavior:** Test overlay positioning across breakpoints\n\n## Implementation Plan\n\n### Phase 1: Database & API (Foundation)\n1. Extend posts table schema with overlay fields\n2. Update Drizzle ORM types\n3. Modify API routes to handle overlay data\n4. Add validation for overlay fields\n\n### Phase 2: Admin Interface (Configuration)\n1. Extend BlogComposer form with overlay section\n2. Add Zod validation for overlay fields\n3. Implement conditional UI (show/hide based on overlayEnabled)\n4. Add form submission handling\n\n### Phase 3: Frontend Components (Display)\n1. Extend BlogPostCard component with overlay props\n2. Create OverlayContainer component\n3. Implement overlay rendering logic\n4. Add responsive styling and positioning\n\n### Phase 4: Integration & Testing (Quality)\n1. End-to-end testing of complete workflow\n2. Performance testing for overlay rendering\n3. Accessibility testing for overlay text\n4. Cross-browser compatibility testing\n",
  "fileStats": {
    "size": 8531,
    "lines": 255,
    "lastModified": "2025-10-31T06:23:00.541Z"
  },
  "comments": []
}
