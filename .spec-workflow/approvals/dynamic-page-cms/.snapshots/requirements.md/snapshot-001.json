{
  "id": "snapshot_1764096160796_8dcmpqd97",
  "approvalId": "approval_1764096160767_zdn5vkbyb",
  "approvalTitle": "Requirements for Dynamic Page CMS Module",
  "version": 1,
  "timestamp": "2025-11-25T18:42:40.796Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: Dynamic Page CMS Module\n\n## Introduction\n\nThis module establishes a complete workflow for content production to frontend rendering within the monorepo architecture. It enables administrators to create and edit pages using a visual block editor (BlockNote), which are then serialized to Markdown and stored. A dynamic catch-all route in the web application then retrieves and renders this content, allowing for flexible page creation without code changes.\n\n## Alignment with Product Vision\n\nThis feature empowers the marketing and content teams to manage website content independently, reducing dependency on developers for creating standard informational pages (e.g., landing pages, policy pages, promotional content). It leverages the existing \"Black Living\" premium brand aesthetic through shared UI components.\n\n## Requirements\n\n### Requirement 1: Admin Page Management\n\n**User Story:** As an Admin, I want to create, edit, and manage dynamic pages using a visual editor, so that I can easily publish new content to the website without writing code.\n\n#### Acceptance Criteria\n\n1.  WHEN the admin navigates to the \"Pages\" section in the dashboard, THEN they SHALL see a list of existing dynamic pages.\n2.  WHEN the admin clicks \"Create New Page\", THEN they SHALL be presented with a form to enter the Page Title, URL Slug, and Content.\n3.  WHEN the admin edits the content, THEN they SHALL use the `BlockNoteEditor` component which supports rich text and blocks.\n4.  WHEN the admin saves the page, THEN the system SHALL serialize the block content to Markdown and store it in the database along with the slug and metadata.\n5.  IF the slug is already in use, THEN the system SHALL prevent saving and show an error message.\n6.  WHEN the admin sets the status to \"Published\", THEN the page SHALL be accessible on the public website.\n\n### Requirement 2: Dynamic Web Routing & Rendering\n\n**User Story:** As a Website Visitor, I want to view pages created by the admin at their specific URLs, so that I can access the latest content.\n\n#### Acceptance Criteria\n\n1.  WHEN a visitor accesses a URL that does not match any static route (e.g., `/about`, `/shop`), THEN the system SHALL attempt to match the path against the dynamic pages database.\n2.  IF a matching published page is found, THEN the system SHALL render the page content using the Markdown parser.\n3.  IF no matching page is found, THEN the system SHALL render the standard 404 error page.\n4.  WHEN the page renders, THEN it SHALL use the site's standard layout (header, footer) and styling.\n5.  WHEN the page renders Markdown content, THEN it SHALL be converted to appropriate HTML/React components that match the site's design system.\n\n### Requirement 3: Data Storage & API\n\n**User Story:** As a Developer, I want a structured data schema for pages, so that content is stored efficiently and can be retrieved quickly by slug.\n\n#### Acceptance Criteria\n\n1.  WHEN a page is created, THEN it SHALL be stored with a unique UUID, unique Slug, Title, Markdown Content, Status (Draft/Published), and timestamps.\n2.  WHEN the web app requests a page by slug, THEN the API SHALL return the page data if it exists and is published.\n3.  WHEN the admin requests a page by ID, THEN the API SHALL return the full page data including draft content.\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n-   **Single Responsibility Principle**: The CMS logic should be encapsulated in its own modules (e.g., `apps/api/src/modules/pages.ts`, `packages/db/schema.ts`).\n-   **Modular Design**: The renderer component in the web app should be reusable.\n-   **Shared Components**: Use `BlockNoteEditor` from the shared admin components.\n\n### Performance\n-   **Caching**: Dynamic page responses should be cached (e.g., using Cloudflare KV or similar mechanism if available in the future) to ensure fast load times, though initial implementation can be direct DB query.\n-   **Optimization**: Markdown parsing should be efficient and not block the main thread significantly.\n\n### Security\n-   **Input Validation**: Slugs must be validated to ensure they are URL-safe and do not conflict with reserved routes.\n-   **Sanitization**: Markdown content rendered on the client must be sanitized to prevent XSS attacks.\n-   **Access Control**: Only authenticated admins can create/edit pages.\n\n### Reliability\n-   **Fallback**: The catch-all route must correctly fallback to 404 without crashing the application if a slug is not found.\n\n### Usability\n-   **Editor Experience**: The BlockNote editor should provide a \"WYSIWYG-like\" experience that closely resembles the final output.\n-   **Slug Management**: The system should suggest a slug based on the title but allow manual editing.",
  "fileStats": {
    "size": 4754,
    "lines": 69,
    "lastModified": "2025-11-25T18:42:20.530Z"
  },
  "comments": []
}
